<script src="{{ '/assets/js/bootstrap.bundle.min.js' | relative_url }}"></script>
<script>
  // Copy citation functionality
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.copy-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var text = this.closest('.citation-box').querySelector('.citation-text').textContent;
        navigator.clipboard.writeText(text).then(function() {
          btn.classList.add('copied');
          btn.innerHTML = '<i class="fas fa-check"></i>';
          setTimeout(function() {
            btn.classList.remove('copied');
            btn.innerHTML = '<i class="far fa-copy"></i>';
          }, 2000);
        });
      });
    });
  });
</script>
<script src="{{ '/assets/js/blocs.min.js' | relative_url }}"></script>
<script src="{{ '/assets/js/lazysizes.min.js' | relative_url }}" defer></script>
<script src="{{ '/assets/js/scrollFX.js' | relative_url }}"></script>
<script src="{{ '/assets/js/tables.js' | relative_url }}"></script>
<script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
<script src="{{ '/assets/js/search.js' | relative_url }}"></script>
<script>
  // Theme toggle functionality
  (function() {
    var toggleBtn = document.querySelector('.theme-toggle');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', function() {
        var currentTheme = document.documentElement.getAttribute('data-bs-theme');
        var newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-bs-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });
    }
  })();

  // Fix navbar dropdown: disable hover when any dropdown is clicked open
  (function() {
    var nav = document.querySelector('.hover-open-submenu');
    if (!nav) return;

    // When a dropdown is shown via click, add class to disable hover
    nav.addEventListener('show.bs.dropdown', function() {
      nav.classList.add('dropdown-clicked');
    });

    // When dropdown is hidden, remove the class
    nav.addEventListener('hide.bs.dropdown', function() {
      nav.classList.remove('dropdown-clicked');
    });
  })();

  // Scroll-to-top button: hide when scrolling up
  (function() {
    var scrollBtn = document.querySelector('.scrollToTop');
    if (!scrollBtn) return;

    var lastScrollY = window.scrollY;
    var hideTimeout = null;
    var showThreshold = 300; // Show button after scrolling this far

    window.addEventListener('scroll', function() {
      var currentScrollY = window.scrollY;

      // Clear any pending hide timeout
      if (hideTimeout) {
        clearTimeout(hideTimeout);
        hideTimeout = null;
      }

      // If near top, hide immediately
      if (currentScrollY < showThreshold) {
        scrollBtn.style.opacity = '0';
        scrollBtn.style.pointerEvents = 'none';
      }
      // If scrolling down and past threshold, show
      else if (currentScrollY > lastScrollY) {
        scrollBtn.style.opacity = '1';
        scrollBtn.style.pointerEvents = 'auto';
      }
      // If scrolling up, hide after short delay
      else if (currentScrollY < lastScrollY) {
        hideTimeout = setTimeout(function() {
          scrollBtn.style.opacity = '0';
          scrollBtn.style.pointerEvents = 'none';
        }, 500);
      }

      lastScrollY = currentScrollY;
    });

    // Add transition for smooth fade
    scrollBtn.style.transition = 'opacity 0.3s ease';
  })();
</script>
{% if page.math or layout.math %}
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '\\[', right: '\\]', display: true},
            {left: '\\(', right: '\\)', display: false},
            {left: '$ ', right: ' $', display: false},
            {left: '$', right: '$', display: false}
        ],
        throwOnError: false
    });"></script>
{% endif %}
